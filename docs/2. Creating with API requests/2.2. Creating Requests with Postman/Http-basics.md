# Основы HTTP (MDN)

> [Оригинал](https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages)

HTTP сообщения — это обмен данными между сервером и клиентом. 

Есть два типа сообщений: **запросы**, отправляемые клиентом, чтобы инициировать реакцию со стороны сервера, 
и **ответы** от сервера.

> Сообщения HTTP состоят из текстовой информации в кодировке ASCII, записанной в несколько строк.

- В HTTP/1.1 и более ранних версиях они пересылались в качестве обычного текста. 
- В HTTP/2 текстовое сообщение разделяется на **фреймы**, что позволяет выполнить оптимизацию и повысить 
  производительность.
  
> Веб разработчики не создают текстовые сообщения HTTP самостоятельно — это делает программа, браузер, прокси или 
> веб-сервер.
> 
> Они обеспечивают создание HTTP сообщений через конфигурационные файлы (для прокси и серверов), APIs (для браузеров) 
> или другие интерфейсы.

## Из чего состоит

- Стартовая строка, описывающая запрос или статус (успех/сбой). Это всегда одно строка.
  - Например: `POST / HTTP/1.1` или (для ответа) `HTTP/1.1 403 Forbidden`
- Произвольный набор HTTP заголовков, определяющих запрос или описывающих тело сообщения
  - Например: `Server: Apache`, `Connection: keep-alive` и так далее
- Пустая строка, указывающая, что вся мета-информация отправлена.
  - Идет сразу после всех HTTP заголовков
- Произвольное тело, содержащее пересылаемые с запросом данные.
  - Наличие тела и его размер определяются стартовой строкой и заголовками HTTP
  - Например: `<!DOCTYPE html>...` - html документ.
    
## Запросы HTTP

### Стартовая строка

HTTP запросы - это сообщения, отправляемые клиентом, чтобы инициировать реакцию со стороны сервера. 

Их стартовая строка состоит из трёх элементов:

- Метод HTTP (`GET`, `PUT`, `POST`). Описывает требуемое действие
  - `GET` - указывает, что необходимо доставить некоторый ресурс
  - `POST` - указывает отправку данных на сервер (для создания или модификации ресурса, или генерации возвращаемого документа)
- Цель запроса, обычно `URL`. Это может быть:
  - Абсолютный путь, за которым следует '?' и строка запроса. 
    Например: `GET /background.png HTTP/1.0`
  - Полный URL. 
    Например: `GET http://developer.mozilla.org/ru/docs/Web/HTTP/Messages HTTP/1.1`
  - Компонента URL "authority". Используется только с методом `CONNECT`. 
    Например: `CONNECT developer.mozilla.org:80 HTTP/1.1`
  - Форма звездочки (asterisk form). Используется с методом `OPTIONS` и представляет сервер.
    Например: `OPTIONS * HTTP/1.1`
- Версия HTTP. Определяет структуру оставшегося сообщения, 
  указывает какую версию предполагается использовать для ответа.

### Заголовки

Заголовки запроса HTTP имеют стандартную для заголовка HTTP структуру: не зависящая от регистра строка, 
завершаемая (':') и значение, структура которого определяется заголовком. 

Весь заголовок, включая значение, представляет собой одну строку, которая может быть довольно длинной.

#### Заголовки запроса

- Основные заголовки
  - Относятся к сообщению в целом
  - Например: `Via: 1.1 vegur`
- Заголовки запроса
  - Уточняют запрос, или придают контекст, или накладывают ограничения на условия.
  - Например: `Accept-Language` (уточняет запрос), `Referer` (придает контекст), `If-None` (накладывает ограничения)
- Заголовки сущности
  - Относятся к телу сообщения. Они отсутствуют, если у запроса нет тела.
  - Например: `Content-Length`

#### Тело

Последней частью запроса является его тело. 
Оно бывает не у всех запросов: запросы, собирающие (fetching) ресурсы, такие как `GET`, `HEAD`, `DELETE`, или `OPTIONS`, 
в нем обычно не нуждаются. 

Но некоторые запросы отправляют на сервер данные для обновления, как это часто бывает с запросами `POST` 
(содержащими данные HTML-форм).

Можно разделить на 2 категории: 

- Одноресурсные тела
  - Состоят из одного отдельного файла, определяемого двумя заголовками: `Content-Type` и `Content-Length`
- Многоресурсные тела
  - Состоят из множества частей, каждая из которых содержит свой бит информации
  - Обычно связаны с HTML формами
    
### Ответы HTTP

#### Строка статуса

Стартовая строка ответа HTTP, называемая строкой статуса, содержит следующую информацию:

- Версия протокола. Например: `HTTP/1.1`
- Код состояния. Например: `200`, `404`, `302` и т.д.
- Пояснение (status text). Краткое текстовое описание кода состояния, помогающее пользователю понять сообщение HTTP.
  Например: `Forbidden`
  
Пример строки статуса `HTTP/1.1 404 Not Found`

#### Заголовки

Имеют ту же структуру, что и все остальные заголовки.

Существует множество заголовков ответов, их можно разделить на следующие группы:

- Основные заголовки
  - Относятся к сообщению целиком
  - Например: `Via`
- Заголовки ответа
  - Сообщают дополнительную информацию о сервере, которая не уместиласть в строку состояния.
  - Например: `Vary` и `Accept-Ranges`
- Заголовки сущности
  - Относятся к телу ответа. Отсутствуют, если у запроса нет тела
  - Например: `Content-Length`

#### Тело

Оно есть не у всех ответов. Например у кодов состояния, `201` и `204` оно обычно отсутствует.

Можно разделить на три категории:

- Одноресурсные тела
  - Состоят из одного отдельного файла, определяемого двумя заголовками: `Content-Type` и `Content-Length`
- Одноресурсные тела, разбитые на чанки
  - Состоят из отдельного файла неизвестной длины, разбитого на небольшие части с заголовком `Transfer-Encoding (en-US)`,
    значением которого является `chunked`
- Многоресурсные тела
  - Состоят из многокомпонентного тела, каждая часть которого содержит свой сегмент информации.
  - Они относительно редки
    
#### Фреймы HTTP/2

HTTP/2 переходит на новый уровень: он делит сообщения HTTP/1.x на фреймы, которые внедряются в поток. 

Фреймы данных из заголовков отделены друг от друга, что позволяет сжимать заголовки. 
Несколько потоков можно объединять друг с другом — такой процесс называется 
мультиплексированием — что позволяет более эффективно использовать TCP-соединения.
